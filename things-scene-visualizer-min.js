!function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function(e){function t(e,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._model=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,THREE.Object3D),r(t,[{key:"dispose",value:function(){var e=this;this.children.slice().forEach(function(t){t.dispose&&t.dispose(),t.geometry&&t.geometry.dispose&&t.geometry.dispose(),t.material&&t.material.dispose&&t.material.dispose(),t.texture&&t.texture.dispose&&t.texture.dispose(),e.remove(t)})}},{key:"createObject",value:function(e){}},{key:"model",get:function(){return this._model}}]),t}();t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=scene,i=n.Component,a=(n.Component3d,n.Container,n.RectPath),s=(n.Layout,n.TableCell,{mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!1,split:!1}},{type:"checkbox",label:"is-empty",name:"isEmpty"}]}),l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a(i)),r(t,[{key:"_drawBorder",value:function(e,t,o,r,n,a){a&&a.strokeStyle&&a.lineWidth&&a.lineDash&&(e.beginPath(),e.moveTo(t,o),e.lineTo(r,n),i.drawStroke(e,a,this))}},{key:"_draw",value:function(e){var t=this.model,o=t.left,r=t.top,n=t.width,i=t.height,a=this.model.border||{};this.model.isEmpty||this._draw_rack_cell(e),e.beginPath(),e.lineWidth=0,e.rect(o,r,n,i);var s=this.parent,l=s.components.indexOf(this),c=s.columns||1,u=s.rows||1;this._drawBorder(e,o,r,o+n,r,a.top),this._drawBorder(e,o,r+i,o,r,a.left),function(e,t,o){return(e+1)%o==0}(l,0,c)&&this._drawBorder(e,o+n,r,o+n,r+i,a.right),function(e,t,o){return e>=(t-1)*o}(l,u,c)&&this._drawBorder(e,o+n,r+i,o,r+i,a.bottom)}},{key:"_post_draw",value:function(e){var o=this.bounds,r=o.left,n=o.top,i=o.width,a=o.height;(function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e),this._focused&&(e.beginPath(),e.fillStyle="rgba(00, 00, 255, 0.7)",e.rect(r,n,i,a),e.fill(),e.closePath())}},{key:"_draw_rack_cell",value:function(e){var t=this.model,o=t.left,r=t.top,n=t.width,i=t.height;e.save(),e.fillStyle="#efefef",e.fillRect(o,r,n,i),e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc",e.moveTo(o,r),e.lineTo(o+n,r+i),e.moveTo(o+n,r),e.lineTo(o,r+i),e.stroke(),e.closePath(),e.restore()}},{key:"ondragstart",value:function(){this._focused=!1}},{key:"onmouseenter",value:function(e){this._focused=!0}},{key:"onmouseleave",value:function(e){this._focused=!1}},{key:"hasTextProperty",get:function(){return!1}},{key:"nature",get:function(){return s}},{key:"merged",set:function(e){this.set("merged",!!e),e&&this.set("text","")},get:function(){return this.get("merged")}},{key:"rowspan",set:function(e){this.set("rowspan",e)},get:function(){return this.get("rowspan")}},{key:"colspan",set:function(e){this.set("colspan",e)},get:function(){return this.get("colspan")}},{key:"border",get:function(){this.model.border}}]),t}();t.default=l,["border"].forEach(function(e){return i.memoize(l.prototype,e,!1)}),i.register("rack-table-cell",l)},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),i=r(o(0)),a=r(o(3)),s=function(e){function t(e,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return n._visualizer=r,n._frames=[],n._boards=[],n.createObject(o),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"dispose",value:function(){(function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),delete this._visualizer}},{key:"createObject",value:function(e){var t=this.model,o=t.type,r=t.left,n=t.top,i=t.width,s=t.height,l=t.depth,c=t.rotation,u=void 0===c?0:c,h=t.fillStyle,f=t.hideRackFrame,p=t.shelves,d=t.shelfPattern,y=t.stockScale,m=void 0===y?.7:y,v=r+i/2-e.width/2,b=n+s/2-e.height/2,_=.5*l*p;if(this.type=o,!f){var g=this.createRackFrame(i,s,l*p);this._frames.push(g),this.add(g)}for(var w=0;w<p;w++){var E=-l*p*.5;if(w>0&&!f){var O=this.createRackBoard(i,s);O.position.set(0,E+l*w,0),O.rotation.x=Math.PI/2,O.material.opacity=.5,O.material.transparent=!0,this.add(O),this._boards.push(O)}var k=new a.default({width:i*m,height:s*m,depth:l*m,fillStyle:h},this._visualizer),T=l*m;k.position.set(0,E+l*w+.5*T,0),k.name=this.makeLocationString(this.makeShelfString(d,w+1,p)),this.add(k),this._visualizer.putObject(k.name,k)}this.position.set(v,_,b),this.rotation.y=-u}},{key:"createRackFrame",value:function(e,o,r){for(var n=Math.round(Math.min(e,o)/10),i=new THREE.Group,a=0;a<4;a++){var s=new THREE.BoxBufferGeometry(n,r,n),l=t.frameMaterial,c=new THREE.Mesh(s,l);switch(a){case 0:c.position.set(e/2,0,o/2);break;case 1:c.position.set(e/2,0,-o/2);break;case 2:c.position.set(-e/2,0,o/2);break;case 3:c.position.set(-e/2,0,-o/2)}i.add(c)}return i}},{key:"createRackBoard",value:function(e,o){var r=t.boardMaterial,n=new THREE.PlaneBufferGeometry(e,o,1,1);return new THREE.Mesh(n,r)}},{key:"cube",value:function(e){var t=.5*e.width,o=.5*e.height,r=.5*e.depth,n=new THREE.Geometry;return n.vertices.push(new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,o,r),new THREE.Vector3(-t,o,r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,-o,r),new THREE.Vector3(t,-o,r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(-t,o,r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(t,-o,r)),n}},{key:"makeLocationString",value:function(e){var t=this._model,o=t.locPattern,r=void 0===o?"{z}{s}-{u}-{sh}":o,n=t.zone,i=void 0===n?"":n,a=t.section,s=void 0===a?"":a,l=t.unit,c=void 0===l?"":l,u=r;return u=u.replace(/{z}/i,i),u=u.replace(/{s}/i,s),u=u.replace(/{u}/i,c),u=u.replace(/{sh}/i,e)}},{key:"makeShelfString",value:function(e,t,o){if(e&&t&&o){var r=/^\-/.test(e),n=((e=e.replace(/#+/,"#")).match(/0/g)||[]).length||0,i=String(r?o-t+1:t);if(i.length>n&&n>0)i=i.split("").shift(i.length-n).join("");else{for(var a="",s=0;s<n-i.length;s++)a+="0";i=a+i}return i}}},{key:"raycast",value:function(e,t){}},{key:"onchange",value:function(e,t){e.hasOwnProperty("data")&&(this.data=e.data)}},{key:"frames",get:function(){return this._frames}},{key:"boards",get:function(){return this._boards}}],[{key:"boardMaterial",get:function(){return t._boardMaterial||(t._boardMaterial=new THREE.MeshBasicMaterial({color:"#dedede",side:THREE.DoubleSide})),t._boardMaterial}},{key:"frameMaterial",get:function(){return t._frameMaterial||(t._frameMaterial=new THREE.MeshLambertMaterial({color:13421772})),t._frameMaterial}}]),t}();t.default=s,scene.Component3d.register("rack",s)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},i=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),a=function(e){function t(e,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._visualizer=o,r._hideEmptyStock=o&&o._stockStatus&&o._stockStatus.hideEmptyStock,r.createObject(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"dispose",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),delete this._visualizer}},{key:"getMaterial",value:function(e){if(!this.stockMaterials[e]){if(!this._visualizer||!this._visualizer._stockStatus)return this.userDefineDefaultMaterial;var t=this._visualizer._stockStatus.ranges[e];t&&t.color||(this.stockMaterials[e]=this.userDefineDefaultMaterial),this.stockMaterials[e]=new THREE.MeshLambertMaterial({color:t.color,side:THREE.FrontSide})}return this.stockMaterials[e]}},{key:"createObject",value:function(){var e=this.model,t=e.width,o=e.height,r=e.depth;this.createStock(t,o,r)}},{key:"createStock",value:function(e,o,r){this.geometry=t.stockGeometry,this.material=this._hideEmptyStock?this.emptyMaterial:this.userDefineDefaultMaterial,this.type="stock",this.scale.set(e,r,o)}},{key:"onUserDataChanged",value:function(){var e=this;if(n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onUserDataChanged",this).call(this),this._visualizer&&this._visualizer._stockStatus){var o=this._visualizer._stockStatus,r=o.field,i=o.ranges;if(r&&i){var a=this.userData[r];void 0!=a?i.some(function(t,o){var r=t.min;if(t.max>a)return void 0!==r?r<=a&&(e.material=e.getMaterial(o)):e.material=e.getMaterial(o),!0}):this.material=this._hideEmptyStock?this.emptyMaterial:this.userDefineDefaultMaterial}}}},{key:"onBeforeRender",value:function(){this._focused?this.rotation.y+=.5:this.rotation.y=0}},{key:"onmouseup",value:function(e,t,o){if(this.visible&&(this.userData&&0!==Object.keys(this.userData).length||(this.userData={loc:this.name}),o&&"function"==typeof o)){var r=Object.assign({color:"#"+this.material.color.getHexString()},this.userData);o.call(this,{data:r,location:"right-top"})}}},{key:"stockMaterials",get:function(){return this._visualizer._stock_materials||(this._visualizer._stock_materials=[]),this._visualizer._stock_materials}},{key:"userDefineDefaultMaterial",get:function(){if(!this._visualizer._default_material){if(!this._visualizer||!this._visualizer._stockStatus)return t.defaultMaterial;var e=this._visualizer._stockStatus.defaultColor;if(!e)return t.defaultMaterial;this._visualizer._default_material=new THREE.MeshLambertMaterial({color:e,side:THREE.FrontSide})}return this._visualizer._default_material}},{key:"emptyMaterial",get:function(){return this._visualizer._empty_material||(this._visualizer._empty_material=new THREE.MeshBasicMaterial,this._visualizer._empty_material.opacity=.25,this._visualizer._empty_material.transparent=!0),this._visualizer._empty_material}}],[{key:"stockGeometry",get:function(){return t._geometry||(t._geometry=new THREE.BoxBufferGeometry(1,1,1)),t._geometry}},{key:"defaultMaterial",get:function(){return t._material_default||(t._material_default=new THREE.MeshLambertMaterial({color:"#ccaa76",side:THREE.FrontSide})),t._material_default}}]),t}();t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o._model=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,THREE.Mesh),r(t,[{key:"dispose",value:function(){var e=this;this.children.slice().forEach(function(t){t.dispose&&t.dispose(),t.geometry&&t.geometry.dispose&&t.geometry.dispose(),t.material&&t.material.dispose&&t.material.dispose(),t.texture&&t.texture.dispose&&t.texture.dispose(),e.remove(t)})}},{key:"model",get:function(){return this._model}}]),t}();t.default=n},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=o(6);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r(n).default}});var i=o(7);Object.defineProperty(t,"Component3d",{enumerable:!0,get:function(){return r(i).default}});var a=o(8);Object.defineProperty(t,"Visualizer",{enumerable:!0,get:function(){return r(a).default}});var s=o(11);Object.defineProperty(t,"VideoPlayer360",{enumerable:!0,get:function(){return r(s).default}});var l=o(12);Object.defineProperty(t,"RackTable",{enumerable:!0,get:function(){return r(l).default}});var c=o(1);Object.defineProperty(t,"RackTableCell",{enumerable:!0,get:function(){return r(c).default}});var u=o(15);Object.defineProperty(t,"Door",{enumerable:!0,get:function(){return r(u).default}});var h=o(16);Object.defineProperty(t,"ForkLift",{enumerable:!0,get:function(){return r(h).default}});var f=o(17);Object.defineProperty(t,"HumiditySensor",{enumerable:!0,get:function(){return r(f).default}});var p=o(18);Object.defineProperty(t,"Person",{enumerable:!0,get:function(){return r(p).default}});var d=o(19);Object.defineProperty(t,"Plane",{enumerable:!0,get:function(){return r(d).default}});var y=o(2);Object.defineProperty(t,"Rack",{enumerable:!0,get:function(){return r(y).default}});var m=o(3);Object.defineProperty(t,"Stock",{enumerable:!0,get:function(){return r(m).default}});var v=o(20);Object.defineProperty(t,"Wall",{enumerable:!0,get:function(){return r(v).default}});var b=o(21);Object.defineProperty(t,"Cube",{enumerable:!0,get:function(){return r(b).default}});var _=o(22);Object.defineProperty(t,"Cylinder",{enumerable:!0,get:function(){return r(_).default}});var g=o(23);Object.defineProperty(t,"Sphere",{enumerable:!0,get:function(){return r(g).default}});var w=o(24);Object.defineProperty(t,"Cone",{enumerable:!0,get:function(){return r(w).default}});var E=o(25);Object.defineProperty(t,"Banner",{enumerable:!0,get:function(){return r(E).default}});var O=o(26);Object.defineProperty(t,"Desk",{enumerable:!0,get:function(){return r(O).default}});var k=o(27);Object.defineProperty(t,"Beacon3D",{enumerable:!0,get:function(){return r(k).default}});var T=o(28);Object.defineProperty(t,"Pallet",{enumerable:!0,get:function(){return r(T).default}})},function(e,t,o){"use strict";THREE&&THREE.Object3D&&(THREE.Object3D.prototype.onUserDataChanged=function(){if(this.userData){if(this.userData.hasOwnProperty("location")){if(!this._visualizer)return;this._setPosition(this._visualizer.transcoord2dTo3d(this.userData.location))}this.userData.hasOwnProperty("euler")&&this._setEuler({yaw:this.userData.euler.yaw,pitch:this.userData.euler.pitch,roll:this.userData.euler.roll}),this.userData.hasOwnProperty("quaternion")&&this._setQuaternion({x:this.userData.quaternion.qx,y:this.userData.quaternion.qy,z:this.userData.quaternion.qz,w:this.userData.quaternion.qw})}},THREE.Object3D.prototype._setPosition=function(e){var t=e.x,o=e.y,r=this._visualizer.mixers.indexOf(this._mixer);r>=0&&this._visualizer.mixers.splice(r,1),this._mixer=new THREE.AnimationMixer(this),this._visualizer.mixers.push(this._mixer);var n=new THREE.VectorKeyframeTrack(".position",[0,1],[this.position.x,this.position.y,this.position.z,t,this.position.y,o]),i=new THREE.AnimationClip("Move",2,[n]),a=this._mixer.clipAction(i);a.clampWhenFinished=!0,a.loop=THREE.LoopOnce,a.play()},THREE.Object3D.prototype._setQuaternion=function(e){var t=e.x,o=e.y,r=e.z,n=e.w,i=new THREE.Quaternion;i.set(t,o,r,n),this.setRotationFromQuaternion(i),this.rotateOnAxis(new THREE.Vector3(1,0,0),-Math.PI),this.rotateOnAxis(new THREE.Vector3(0,1,0),Math.PI),this.rotateOnAxis(new THREE.Vector3(0,0,1),-Math.PI/2)},THREE.Object3D.prototype._setEuler=function(e){var t=e.yaw,o=e.pitch,r=e.roll,n=new THREE.Euler;n.set(t,o,r,"ZYX"),this.setRotationFromEuler(n)})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n={},i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"register",value:function(e,t){if(!t)return n[e];n[e]=t}}]),e}();t.default=i,scene.Component3d=i},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(){n.done||(THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),n.done=!0)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),a=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},s=(r(o(9)),r(o(10)));THREE.Cache.enabled=!0;var l=scene,c=l.Component,u=l.Container,h=l.Layout,f=l.Layer,p={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"fov",name:"fov",property:"fov"},{type:"number",label:"near",name:"near",property:"near"},{type:"number",label:"far",name:"far",property:"far"},{type:"number",label:"zoom",name:"zoom",property:"zoom"},{type:"select",label:"precision",name:"precision",property:{options:["highp","mediump","lowp"]}},{type:"checkbox",label:"anti-alias",name:"antialias",property:"antialias"},{type:"checkbox",label:"auto-rotate",name:"autoRotate",property:"autoRotate"},{type:"checkbox",label:"show-axis",name:"showAxis",property:"showAxis"},{type:"checkbox",label:"3dmode",name:"threed",property:"threed"},{type:"checkbox",label:"debug",name:"debug",property:"threed"},{type:"string",label:"popup-scene",name:"popupScene"},{type:"stock-status",label:"",name:"stockStatus"}]},d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u),i(t,[{key:"containable",value:function(e){return e.is3dish()}},{key:"putObject",value:function(e,t){this._objects||(this._objects={}),this._objects[e]=t}},{key:"getObject",value:function(e){return this._objects||(this._objects={}),this._objects[e]}},{key:"createFloor",value:function(e,t,o){var r=this.model.fillStyle,n=this;if("pattern"==r.type&&r.image)var i=this._textureLoader.load(this.app.url(r.image),function(e){e.minFilter=THREE.LinearFilter,n.render_threed()}),a=[a=new THREE.MeshLambertMaterial({color:e}),a=new THREE.MeshLambertMaterial({color:e}),a=new THREE.MeshLambertMaterial({color:e}),a=new THREE.MeshLambertMaterial({color:e}),new THREE.MeshLambertMaterial({map:i}),a=new THREE.MeshLambertMaterial({color:e})];else a=new THREE.MeshLambertMaterial({color:e});var s=new THREE.BoxGeometry(1,1,1),l=new THREE.Mesh(s,a);l.scale.set(t,o,5),l.rotation.x=-Math.PI/2,l.position.y=-2,l.name="floor",this._scene3d.add(l)}},{key:"createObjects",value:function(e,t){var o=this;e.forEach(function(e){requestAnimationFrame(function(){var r=scene.Component3d.register(e.model.type);if(r){var n=new r(e.hierarchy,t,o,e);n&&setTimeout(function(){n.name=e.model.id,this._scene3d.add(n),this.putObject(e.model.id,n)}.bind(o))}else console.warn("Class not found : 3d class is not exist")})})}},{key:"makeTextSprite",value:function(e,t){if(e){void 0===t&&(t={});var o=t.hasOwnProperty("fontFace")?t.fontFace:"Arial",r=t.hasOwnProperty("fontSize")?t.fontSize:16,n=t.hasOwnProperty("textColor")?t.textColor:"rgba(255,255,255,1)",i=t.hasOwnProperty("borderWidth")?t.borderWidth:0,a=t.hasOwnProperty("borderColor")?t.borderColor:"rgba(0, 0, 0, 1.0)",s=t.hasOwnProperty("backgroundColor")?t.backgroundColor:"rgba(0, 0, 0, 0.7)",l=t.hasOwnProperty("radius")?t.radius:15,c=t.hasOwnProperty("vAlign")?t.vAlign:"middle",u=t.hasOwnProperty("hAlign")?t.hAlign:"center",h=document.createElement("canvas"),f=h.getContext("2d"),p=document.createElement("span");p.style.font=r+"px "+o,p.style.whiteSpace="pre-wrap",p.innerText=e,document.body.appendChild(p),h.width=p.offsetWidth+2*(i+l),h.height=p.offsetHeight+2*(i+l),document.body.removeChild(p),p.remove(),f.font=r+"px "+o,f.textBaseline="alphabetic",f.textAlign="left";var d=0,y=String(e).trim().split("\n"),m=h.width/2,v=h.height/2;for(var b in y){var _=f.measureText(y[b]);d<_.width&&(d=_.width)}var g=d/2;"bottom"==c?r:"top"==c&&0,"left"==u?g=d:"right"==u&&(g=0),this.roundRect(f,m-g,v-r*y.length*.5,d,r*y.length,l,i,a,s,5),f.fillStyle=n,f.lineWidth=3;var w=v-r*y.length*.5-5-i;for(var E in y)E=Number(E),w+=r,f.fillText(y[E],m-g,w);var O=new THREE.Texture(h);O.needsUpdate=!0;var k=new THREE.SpriteMaterial({map:O}),T=new THREE.Sprite(k);return T.scale.set(h.width,h.height,1),T.raycast=function(){},T}}},{key:"destroy_scene3d",value:function(){if(this.stop(),this._renderer&&this._renderer.clear(),delete this._renderer,delete this._camera,delete this._2dCamera,delete this._keyboard,delete this._controls,delete this._projector,delete this._load_manager,delete this._objects,this._scene3d){var e=this._scene3d.children.slice();for(var t in e){var o=e[t];o.dispose&&o.dispose(),o.geometry&&o.geometry.dispose&&o.geometry.dispose(),o.material&&o.material.dispose&&o.material.dispose(),o.texture&&o.texture.dispose&&o.texture.dispose(),this._scene3d.remove(o)}}if(this._scene2d){var r=this._scene2d.children.slice();for(var n in r){var i=r[n];i.dispose&&i.dispose(),i.geometry&&i.geometry.dispose(),i.material&&i.material.dispose(),i.texture&&i.texture.dispose(),this._scene2d.remove(i)}}delete this._scene3d,delete this._scene2d}},{key:"init_scene3d",value:function(){this._scene3d&&this.destroy_scene3d(),n(),this._textureLoader=new THREE.TextureLoader,this._textureLoader.withCredential=!0,this._textureLoader.crossOrigin="use-credentials",this._exporter=new THREE.OBJExporter;var e=this.model,t=e.width,o=e.height,r=e.fov,i=void 0===r?45:r,a=e.near,l=void 0===a?.1:a,c=e.far,u=void 0===c?2e4:c,h=e.fillStyle,f=void 0===h?"#424b57":h,p=e.light,d=void 0===p?16777215:p,y=e.antialias,m=void 0===y||y,v=e.precision,b=void 0===v?"highp":v,_=e.stockStatus,g=this.components||[];this._scene3d=new THREE.Scene,this._scene2d=new THREE.Scene;var w=t/o;if(this._camera=new THREE.PerspectiveCamera(i,w,l,u),this._2dCamera=new THREE.OrthographicCamera(-t/2,t/2,o/2,-o/2,1,1e3),this._scene3d.add(this._camera),this._scene2d.add(this._2dCamera),this._camera.position.set(.8*o,Math.floor(Math.min(t,o)),.8*t),this._2dCamera.position.set(0,0,0),this._camera.lookAt(this._scene3d.position),this._2dCamera.lookAt(this._scene2d.position),this._camera.zoom=.01*this.model.zoom,this.model.showAxis){var E=new THREE.AxisHelper(t);this._scene3d.add(E)}this._stockStatus=_;try{this._renderer=new THREE.WebGLRenderer({precision:b,alpha:!0,antialias:m})}catch(e){this._noSupportWebgl=!0}if(!this._noSupportWebgl){this._renderer.autoClear=!1,this._renderer.setClearColor(16777215,0),this._renderer.setSize(t,o),this._controls=new s.default(this._camera,this);var O=new THREE.HemisphereLight(d,0,1);O.position.set(-this._camera.position.x,this._camera.position.y,-this._camera.position.z),this._camera.add(O),this._raycaster=new THREE.Raycaster,this._mouse=new THREE.Vector2,this._tick=0,this._clock=new THREE.Clock(!0),this.mixers=new Array,this.createFloor(f,t,o),this.createObjects(g,{width:t,height:o}),this._load_manager=new THREE.LoadingManager,this._load_manager.onProgress=function(e,t,o){},this.threed_animate()}}},{key:"threed_animate",value:function(){this._animationFrame=requestAnimationFrame(this.threed_animate.bind(this)),this.update()}},{key:"stop",value:function(){cancelAnimationFrame(this._animationFrame)}},{key:"update",value:function(){this._controls.update(),this.render_threed()}},{key:"render_threed",value:function(){var e;this._clock&&(e=this._clock.getDelta());var t=this.mixers;for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];r&&r.update(e)}this._renderer&&(this._renderer.clear(),this._renderer.render(this._scene3d,this._camera)),this._renderer&&this._scene2d&&this._renderer.render(this._scene2d,this._2dCamera),this.invalidate()}},{key:"_draw",value:function(e){this.app.isViewMode&&(this.model.threed||(this.model.threed=!0)),this.model.threed&&!this._noSupportWebgl||a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_draw",this).call(this,e)}},{key:"_post_draw",value:function(e){var o=this.model,r=o.left,n=o.top,i=o.width,s=o.height,l=o.debug;if(o.threed){if(this._scene3d||(this.init_scene3d(),this.render_threed()),this._noSupportWebgl)return void this._showWebglNoSupportText(e);this._dataChanged&&this._onDataChanged(),this.showTooltip(this._selectedPickingLocation),e.drawImage(this._renderer.domElement,0,0,i,s,r,n,i,s),l&&(e.font="100px Arial",e.textAlign="center",e.fillStyle="black",e.globalAlpha=.5,e.fillText(scene.FPS(),100,100))}else a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e)}},{key:"dispose",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),this.destroy_scene3d()}},{key:"roundRect",value:function(e,t,o,r,n,i,a,s,l,c,u){if(void 0!=l||void 0!=s){var h=t-a-i-c,f=h+r+2*a+2*i+2*c,p=o-a-i-c,d=p+n+2*a+2*i+2*c;e.beginPath(),e.moveTo(h+i,p),e.lineTo(f-i,p),e.quadraticCurveTo(f,p,f,p+i),e.lineTo(f,d-i),e.quadraticCurveTo(f,d,f-i,d),e.lineTo(h+i,d),e.quadraticCurveTo(h,d,h,d-i),e.lineTo(h,p+i),e.quadraticCurveTo(h,p,h+i,p),e.closePath(),e.lineWidth=a,void 0!=l&&(e.fillStyle=l,e.fill()),a>0&&void 0!=s&&(e.strokeStyle=s,e.stroke())}}},{key:"getObjectByRaycast",value:function(){var e,t=this.getObjectsByRaycast();return t.length>0&&(e=t[0].object),e}},{key:"getObjectsByRaycast",value:function(){var e=this._mouse;if(this._camera){this._raycaster.setFromCamera(e,this._camera);return this._raycaster.intersectObjects(this._scene3d.children,!0)}}},{key:"moveCameraTo",value:function(e){if(e){var t=this._scene3d.getObjectByName(e,!0);if(t){var o=this,r=t.getWorldPosition();r.y=0;var n=r.distanceTo(new THREE.Vector3(0,0,0));r.multiplyScalar(1e3/(n||1));var o=this,i=this._camera.position.x-r.x,a=this._camera.position.y-300,s=this._camera.position.z-r.z;this.animate({step:function(e){var t=new THREE.Vector3;t.x=r.x-i*(e-1),t.y=0,t.z=r.z-s*(e-1);var n=t.distanceTo(new THREE.Vector3(0,0,0));t.multiplyScalar(1e3/(n||1)),o._camera.position.x=t.x,o._camera.position.y=300-a*(e-1),o._camera.position.z=t.z,o._camera.lookAt(o._scene3d.position)},duration:2e3,delta:"linear"}).start()}}}},{key:"exportModel",value:function(){var e=this._exporter.parse(this._scene3d);new Blob([e],{type:"text/plain;charset=utf-8"});console.log(e)}},{key:"createTooltipForNavigator",value:function(e){if(e){var t=document.createElement("canvas"),o=t.getContext("2d");t.width=window.innerWidth,t.height=window.innerHeight,o.font="40px Arial",o.textBaseline="alphabetic",o.textAlign="left";var r=0,n=t.width/2,i=t.height/2;o.font=Math.floor(40)+"px Arial";var a=o.measureText("Location");r<a.width&&(r=a.width),o.font="bold 80px Arial",r<(a=o.measureText(e.location)).width&&(r=a.width),o.font="40px Arial",r<(a=o.measureText("- Material : "+e.material)).width&&(r=a.width),r<(a=o.measureText("- QTY : "+e.qty)).width&&(r=a.width);var s=r/2,l=20,c=i;this.roundRect(o,n-s,i-120,r,320,30,2,"rgba(0, 0, 0, 1.0)","rgba(0, 0, 0, 0.7)",0),o.fillStyle="rgba(255,255,255,1)",o.lineWidth=3,c+=-120+Math.floor(40),o.font=Math.floor(40)+"px Arial",o.fillStyle="rgba(134,199,252,1)",o.fillText("Location",n-s,c),c+=100,o.font="bold 80px Arial",o.fillStyle="rgba(255,255,255,1)",o.fillText(e.location,n-s,c),c+=80,o.font="40px Arial",o.fillStyle="rgba(204,204,204,1)",o.fillText("- Material : "+e.material,n-s,c),c+=40+l,o.fillText("- QTY : "+e.qty,n-s,c);var u=new THREE.Texture(t);u.needsUpdate=!0;var h=new THREE.SpriteMaterial({map:u}),f=new THREE.Sprite(h);return f.scale.set(window.innerWidth/4*3,window.innerWidth/8*3,1),f.raycast=function(){},f}}},{key:"showTooltip",value:function(e){if(e){var t=this._scene2d.getObjectByName("navigator-tooltip");t&&this._scene2d.remove(t);var o=this._scene3d.getObjectByName(e,!0),r=this._scene3d.getObjectByName(e+"-marker",!0);if(o&&r){var n=r.getWorldPosition().clone();n.project(this._camera),n.z=.5;var i={location:o.userData.location,material:o.userData.material,qty:o.userData.qty},a=(t=this.createTooltipForNavigator(i)).getWorldScale().clone(),s=a.x/this.model.width,l=a.y/this.model.height;a.normalize(),a.x=0,a.y=1.5*a.y*l,a.z=0,n.add(a),n.unproject(this._2dCamera),t.position.set(n.x,n.y,n.z),t.name="navigator-tooltip",t.scale.x=t.scale.x*s,t.scale.y=t.scale.y*l,this._scene2d.add(t),this.render_threed()}}}},{key:"transcoord2dTo3d",value:function(e){var t=this.model,o=t.width,r=t.height,n=e.x,i=void 0===n?0:n,a=e.y,s=void 0===a?0:a,l=e.z,c=void 0===l?0:l,u=o/2,h=r/2,f={};return f.x=i-u,f.y=s-h,f.z=c,f}},{key:"_showWebglNoSupportText",value:function(e){e.save();var t=this.model,o=t.width,r=t.height;e.font=o/20+"px Arial",e.textAlign="center",e.fillText("WebGL no support",o/2-o/40,r/2),e.restore()}},{key:"_onDataChanged",value:function(){var e=this;if(this._data)if(this._data instanceof Array)this._data.forEach(function(t){var o=t;requestAnimationFrame(function(){var t=o.loc||o.LOC||o.location||o.LOCATION,r=e.getObject(t);r&&(r.userData=o,r.onUserDataChanged())})});else{for(var t in this._data)!function(){var o=t;e._data.hasOwnProperty(o)&&requestAnimationFrame(function(){var t=e._data[o],r=e.getObject(o);r&&(r.userData=t,r.onUserDataChanged())})}()}this._dataChanged=!1,this._pickingLocations&&this._pickingLocations.length>0&&this.navigatePath(this._pickingLocations),this.render_threed()}},{key:"onchange",value:function(e,t){(e.hasOwnProperty("width")||e.hasOwnProperty("height")||e.hasOwnProperty("threed"))&&this.destroy_scene3d(),e.hasOwnProperty("autoRotate")&&(this._controls.autoRotate=e.autoRotate),(e.hasOwnProperty("fov")||e.hasOwnProperty("near")||e.hasOwnProperty("far")||e.hasOwnProperty("zoom"))&&this._camera&&(this._camera.near=this.model.near,this._camera.far=this.model.far,this._camera.zoom=.01*this.model.zoom,this._camera.fov=this.model.fov,this._camera.updateProjectionMatrix(),this._controls.cameraChanged=!0,this._controls.update()),e.hasOwnProperty("data")&&this._data!==e.data&&(this._data=e.data,this._dataChanged=!0),this.invalidate()}},{key:"onmousedown",value:function(e){this._controls&&this._controls.onMouseDown(e)}},{key:"onmouseup",value:function(e){if(this._controls){this._lastFocused&&(this._lastFocused._focused=!1);var t=f.register("model-layer").Popup,o=this.model.popupScene,r=this.transcoordC2S(e.offsetX,e.offsetY);this._mouse.x=(r.x-this.model.left)/this.model.width*2-1,this._mouse.y=-(r.y-this.model.top)/this.model.height*2+1;var n=this.getObjectByRaycast();n&&n.onmouseup?(o&&n.onmouseup(e,this,t.show.bind(this,this,o)),n._focused=!0,this._lastFocused=n):t.hide(this.root),e.stopPropagation()}}},{key:"onmousemove",value:function(e){if(this._controls){var t=this.transcoordC2S(e.offsetX,e.offsetY);this._mouse.x=(t.x-this.model.left)/this.model.width*2-1,this._mouse.y=-(t.y-this.model.top)/this.model.height*2+1,this._controls.onMouseMove(e),e.stopPropagation()}}},{key:"onmouseleave",value:function(e){if(this._scene2d){var t=this._scene2d.getObjectByName("tooltip");t&&this._scene2d.remove(t)}}},{key:"onwheel",value:function(e){this._controls&&(this.handleMouseWheel(e),e.stopPropagation())}},{key:"ondragstart",value:function(e){if(this._controls){var t=this.transcoordC2S(e.offsetX,e.offsetY);this._mouse.x=(t.x-this.model.left)/this.model.width*2-1,this._mouse.y=-(t.y-this.model.top)/this.model.height*2+1,this._controls.onDragStart(e),e.stopPropagation()}}},{key:"ondragmove",value:function(e){this._controls&&(this._controls.onDragMove(e),e.stopPropagation())}},{key:"ondragend",value:function(e){this._controls&&(this._controls.onDragEnd(e),e.stopPropagation())}},{key:"ontouchstart",value:function(e){this._controls&&(this._controls.onTouchStart(e),e.stopPropagation())}},{key:"ontouchmove",value:function(e){this._controls&&(this._controls.onTouchMove(e),e.stopPropagation())}},{key:"ontouchend",value:function(e){this._controls&&(this._controls.onTouchEnd(e),e.stopPropagation())}},{key:"onkeydown",value:function(e){this._controls&&(this._controls.onKeyDown(e),e.stopPropagation())}},{key:"handleMouseWheel",value:function(e){var t=this.model.zoom;(t+=.1*-e.deltaY)<100&&(t=100),this.set("zoom",t)}},{key:"scene3d",get:function(){return this._scene3d||this.init_scene3d(),this._scene3d}},{key:"layout",get:function(){return h.get("three")}},{key:"nature",get:function(){return p}}]),t}();t.default=d,c.register("visualizer",d)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={reflow:function(e,t){},capturables:function(e){return e.get("threed")?[]:e.components},drawables:function(e){return e.get("threed")?[]:e.components},isStuck:function(e){return!1}};scene.Layout.register("three",r),t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){function o(){return Math.pow(.95,c.zoomSpeed)}function r(e){d-=e}function n(e){p-=e}function i(e){c.object instanceof THREE.PerspectiveCamera?y/=e:c.object instanceof THREE.OrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function a(e){c.object instanceof THREE.PerspectiveCamera?y*=e:c.object instanceof THREE.OrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}this.object=e,this.component=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=this.component.model.autoRotate||!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.cameraChanged=!1,this.getPolarAngle=function(){return l},this.getAzimuthalAngle=function(){return s},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.update(),h=u.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=o.clone().inverse(),i=new THREE.Vector3,a=new THREE.Quaternion;return function(){var e=c.object.position;t.copy(e).sub(c.target),t.applyQuaternion(o),s=Math.atan2(t.x,t.z),l=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),c.autoRotate&&h===u.NONE&&r(2*Math.PI/60/60*c.autoRotateSpeed),s+=d,l+=p,s=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,s)),l=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,l)),l=Math.max(f,Math.min(Math.PI-f,l));var v=t.length()*y;return v=Math.max(c.minDistance,Math.min(c.maxDistance,v)),c.target.add(m),t.x=v*Math.sin(l)*Math.sin(s),t.y=v*Math.cos(l),t.z=v*Math.sin(l)*Math.cos(s),t.applyQuaternion(n),e.copy(c.target).add(t),c.object.lookAt(c.target),!0===c.enableDamping?(d*=1-c.dampingFactor,p*=1-c.dampingFactor):(d=0,p=0),y=1,m.set(0,0,0),!!(c.cameraChanged||i.distanceToSquared(c.object.position)>f||8*(1-a.dot(c.object.quaternion))>f)&&(i.copy(c.object.position),a.copy(c.object.quaternion),c.cameraChanged=!1,c.component.render_threed(),!0)}}(),this.dispose=function(){},this.onMouseDown=function(e){},this.onMouseMove=function(e){},this.onMouseUp=function(e){},this.onDragStart=function(e){if(!1!==this.enabled&&!1!==this.enableRotate)switch(c.component.stop(),h=!0===e.altKey?u.PAN:u.ROTATE){case u.ROTATE:this.enableRotate&&function(e){b.set(e.offsetX,e.offsetY)}(e);break;case u.DOLLY:this.enableZoom&&function(e){k.set(e.offsetX,e.offsetY)}(e);break;case u.PAN:this.enablePan&&function(e){w.set(e.offsetX,e.offsetY)}(e)}},this.onDragMove=function(e){if(this.enabled)switch(h=!0===e.altKey?u.PAN:u.ROTATE){case u.ROTATE:this.enableRotate&&function(e){_.set(e.offsetX,e.offsetY),g.subVectors(_,b);var t=c.component;r(2*Math.PI*g.x/t.get("width")*c.rotateSpeed),n(2*Math.PI*g.y/t.get("height")*c.rotateSpeed),b.copy(_),c.update()}(e);break;case u.DOLLY:this.enableZoom&&function(e){T.set(e.offsetX,e.offsetY),R.subVectors(T,k),R.y>0?i(o()):R.y<0&&a(o()),k.copy(T),c.update()}(e);break;case u.PAN:this.enablePan&&function(e){E.set(e.offsetX,e.offsetY),O.subVectors(E,w),x(O.x,O.y),w.copy(E),c.update()}(e)}},this.onDragEnd=function(e){!1!==this.enabled&&!1!==this.enableRotate&&(h=u.NONE,c.component.threed_animate())},this.onKeyDown=function(e){!1!==this.enabled&&!1!==this.enableKeys&&!1!==this.enablePan&&function(e){switch(e.keyCode){case c.keys.UP:x(0,c.keyPanSpeed),c.update();break;case c.keys.BOTTOM:x(0,-c.keyPanSpeed),c.update();break;case c.keys.LEFT:x(c.keyPanSpeed,0),c.update();break;case c.keys.RIGHT:x(-c.keyPanSpeed,0),c.update()}}(e)},this.onTouchStart=function(e){},this.onTouchMove=function(e){},this.onTouchEnd=function(e){};var s,l,c=this,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},h=u.NONE,f=1e-6,p=0,d=0,y=1,m=new THREE.Vector3,v=!1,b=new THREE.Vector2,_=new THREE.Vector2,g=new THREE.Vector2,w=new THREE.Vector2,E=new THREE.Vector2,O=new THREE.Vector2,k=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,j=function(){var e=new THREE.Vector3;return function(t,o){var r=o.elements;e.set(r[0],r[1],r[2]),e.multiplyScalar(-t),m.add(e)}}(),P=function(){var e=new THREE.Vector3;return function(t,o){var r=o.elements;e.set(r[4],r[5],r[6]),e.multiplyScalar(t),m.add(e)}}(),x=function(){var e=new THREE.Vector3;return function(t,o){var r=c.component===document?c.component.body:c.component;if(c.object instanceof THREE.PerspectiveCamera){var n=c.object.position;e.copy(n).sub(c.target);var i=e.length();i*=Math.tan(c.object.fov/2*Math.PI/180),j(2*t*i/r.model.height,c.object.matrix),P(2*o*i/r.model.height,c.object.matrix)}else c.object instanceof THREE.OrthographicCamera?(j(t*(c.object.right-c.object.left)/r.model.width,c.object.matrix),P(o*(c.object.top-c.object.bottom)/r.model.height,c.object.matrix)):(console.warn("WARNING: ThreeControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();this.update()};(r.prototype={}).constructor=r,t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=scene,i=n.RectPath,a=n.Component,s={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"src",name:"src",property:"src"},{type:"checkbox",label:"autoplay",name:"autoplay",property:"autoplay"}]},l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i(a)),r(t,[{key:"init_scene",value:function(e,t){var o=this.model,r=o.mute,n=o.loop,i=o.autoplay,a=o.src,s=o.fov,l=o.clickAndDrag,c=o.wheelEnabled;this._dragStart={},this._lon=0,this._lat=0,this._clickAndDrag=l,this._isPlaying=!1,this._wheelEnabled=c,this._fov=s||35,this._fovMin=3,this._fovMax=100,this._time=(new Date).getTime(),this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(s,e/t,.1,1e3),this._camera.setFocalLength(s),this._renderer=new THREE.WebGLRenderer,this._renderer.setSize(e,t),this._renderer.autoClear=!1,this._renderer.setClearColor(3355443,1),this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.loop=n,this._video.muted=r,this._texture=new THREE.Texture(this._video);var u=this;this._video.addEventListener("ended",function(){this._isPlaying=!1}),this._video.addEventListener("progress",function(){var e=null;u._video&&u._video.buffered&&u._video.buffered.length>0&&u._video.buffered.end&&u._video.duration?e=u._video.buffered.end(0)/u._video.duration:u._video&&void 0!==u._video.bytesTotal&&u._video.bytesTotal>0&&void 0!==u._video.bufferedBytes&&(e=u._video.bufferedBytes/u._video.bytesTotal);Math.round(100*e)}),this._video.addEventListener("canplay",function(){!0===i&&(u.play(),u._videoReady=!0)}),this._video.src=this.app.url(a),this._texture.generateMipmaps=!1,this._texture.minFilter=THREE.LinearFilter,this._texture.magFilter=THREE.LinearFilter,this._texture.format=THREE.RGBFormat,this._mesh=new THREE.Mesh(new THREE.SphereGeometry(500,80,50),new THREE.MeshBasicMaterial({map:this._texture})),this._mesh.scale.x=-1,this._scene.add(this._mesh),this.animate()}},{key:"destroy_scene",value:function(){cancelAnimationFrame(this._requestAnimationId),this._requestAnimationId=void 0,this._texture.dispose(),this._scene.remove(this._mesh),this.unloadVideo(),this._renderer=void 0,this._camera=void 0,this._keyboard=void 0,this._controls=void 0,this._projector=void 0,this._load_manager=void 0,this._scene=void 0,this._video=void 0}},{key:"loadVideo",value:function(e){this._video.src=e}},{key:"unloadVideo",value:function(){this.pause(),this._video.src="",this._video.removeAttribute("src")}},{key:"play",value:function(){this._isPlaying=!0,this._video.play()}},{key:"pause",value:function(){this._isPlaying=!1,this._video.pause()}},{key:"resize",value:function(e,t){this._renderer&&(this._renderer.setSize(e,t),this._camera.aspect=e/t,this._camera.updateProjectionMatrix())}},{key:"animate",value:function(){if(this._requestAnimationId=requestAnimationFrame(this.animate.bind(this)),this._video.readyState===this._video.HAVE_ENOUGH_DATA&&void 0!==this._texture){var e=(new Date).getTime();e-this._time>=30&&(this._texture.needsUpdate=!0,this._time=e)}this.render(),this.invalidate()}},{key:"render",value:function(){this._lat=Math.max(-85,Math.min(85,this._lat||0)),this._phi=(90-this._lat)*Math.PI/180,this._theta=(this._lon||0)*Math.PI/180;var e=500*Math.sin(this._phi)*Math.cos(this._theta),t=500*Math.cos(this._phi),o=500*Math.sin(this._phi)*Math.sin(this._theta);this._camera.lookAt(new THREE.Vector3(e,t,o)),this.model.flatProjection?(this._camera.position.x=0,this._camera.position.y=0,this._camera.position.z=0):(this._camera.position.x=-e,this._camera.position.y=-t,this._camera.position.z=-o),this._renderer.clear(),this._renderer.render(this._scene,this._camera)}},{key:"createControls",value:function(){var e=this.options.muted?"fa-volume-off":"fa-volume-up",t='           <div class="controls">               <a href="#" class="playButton button fa '+(this.options.autoplay?"fa-pause":"fa-play")+'"></a>               <a href="#" class="muteButton button fa '+e+'"></a>               <a href="#" class="fullscreenButton button fa fa-expand"></a>           </div>       ';$(this.element).append(t,!0),this.options.hideControls&&$(this.element).find(".controls").hide()}},{key:"attachControlEvents",value:function(){var e=this;this.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.element.addEventListener("touchmove",this.onMouseMove.bind(this),!1),this.element.addEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.element.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.element.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.element.addEventListener("touchstart",this.onMouseDown.bind(this),!1),this.element.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.element.addEventListener("touchend",this.onMouseUp.bind(this),!1),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",this.fullscreen.bind(this)),$(window).resize(function(){e.resizeGL($(e.element).width(),$(e.element).height())}),$(this.element).find(".playButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-pause")?($(this).removeClass("fa-pause").addClass("fa-play"),e.pause()):($(this).removeClass("fa-play").addClass("fa-pause"),e.play())}),$(this.element).find(".fullscreenButton").click(function(t){t.preventDefault();var o=$(e.element)[0];$(this).hasClass("fa-expand")?o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen?o.msRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen():o.requestFullscreen?document.exitFullscreen():o.msRequestFullscreen?document.msExitFullscreen():o.mozRequestFullScreen?document.mozCancelFullScreen():o.webkitRequestFullscreen&&document.webkitExitFullscreen()}),$(this.element).find(".muteButton").click(function(t){t.preventDefault(),$(this).hasClass("fa-volume-off")?($(this).removeClass("fa-volume-off").addClass("fa-volume-up"),e._video.muted=!1):($(this).removeClass("fa-volume-up").addClass("fa-volume-off"),e._video.muted=!0)})}},{key:"_draw",value:function(e){var t=this.model,o=t.left,r=t.top,n=t.width,i=t.height;t.src;e.beginPath(),e.rect(o,r,n,i)}},{key:"_post_draw",value:function(e){var t=this.model,o=t.left,r=t.top,n=t.width,i=t.height;t.src?(this._scene||(this.init_scene(n,i),this.render()),e.drawImage(this._renderer.domElement,0,0,n,i,o,r,n,i)):this.drawFill(e),this.drawStroke(e)}},{key:"onchange",value:function(e,t){(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&this.resize(this.model.width,this.model.height),(e.hasOwnProperty("src")||e.hasOwnProperty("autoplay"))&&this.destroy_scene(),this.invalidate()}},{key:"ondblclick",value:function(e){this._isPlaying?this.pause():this.play(),e.stopPropagation()}},{key:"onmousedown",value:function(e){}},{key:"onmousemove",value:function(e){if(!1===this._clickAndDrag){var t,o;this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat,t=e.offsetX-this._renderer.getContext().canvas.offsetLeft,o=e.offsetY-this._renderer.getContext().canvas.offsetTop,this._lon=t/this._renderer.getContext().canvas.width*430-225,this._lat=o/this._renderer.getContext().canvas.height*-180+90}}},{key:"onwheel",value:function(e){if(!1!==this._wheelEnabled){this._fov-=.01*e.deltaY,this._fov<this._fovMin?this._fov=this._fovMin:this._fov>this._fovMax&&(this._fov=this._fovMax),this._camera.setFocalLength(this._fov),this._camera.updateProjectionMatrix(),e.stopPropagation()}}},{key:"ondragstart",value:function(e){this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY}},{key:"ondragmove",value:function(e){if(!1!==this._isPlaying){if(!1!==this._clickAndDrag){this._onPointerDownPointerX=e.offsetX,this._onPointerDownPointerY=-e.offsetY,this._onPointerDownLon=this._lon,this._onPointerDownLat=this._lat;var t,o;t=e.offsetX-this._dragStart.x,o=e.offsetY-this._dragStart.y,this._dragStart.x=e.offsetX,this._dragStart.y=e.offsetY,this._lon+=t,this._lat-=o}e.stopPropagation()}}},{key:"ondragend",value:function(e){}},{key:"ontouchstart",value:function(e){}},{key:"ontouchmove",value:function(e){}},{key:"ontouchend",value:function(e){}},{key:"onkeydown",value:function(e){}},{key:"nature",get:function(){return s}}]),t}();t.default=l,a.register("video-player-360",l)},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return x.compile({type:"rack-table-cell",strokeStyle:"black",fillStyle:"transparent",left:0,top:0,width:1,height:1,textWrap:!0,isEmpty:!1,border:c(C,"all")},e)}function l(e,t){var o=JSON.parse(JSON.stringify(e));return delete o.text,x.compile(o,t)}function c(e,t){return(H[t]||[]).reduce(function(t,o){return t[o]=e,t},{})}function u(e,t,o){e&&e.set("border",Object.assign({},e.get("border")||{},c(t,o)))}function h(e,t,o,r){return 0==r||!(r%t)||-1==o.indexOf(r-1)}function f(e,t,o,r){return r==e-1||r%t==t-1||-1==o.indexOf(r+1)}function p(e,t,o,r){return r<t||-1==o.indexOf(r-t)}function d(e,t,o,r){return r>e-t-1||-1==o.indexOf(r+t)}function y(e,t){return t-e}function m(e,t){return t+e}function v(e,t){return t%e?t-1:-1}function b(e,t){return(t+1)%e?t+1:-1}function _(e,t){for(var o=[],r=0;r<t;r++)o.push(1);return o}Object.defineProperty(t,"__esModule",{value:!0}),t.RackTable=void 0;var g=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),w=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},E=r(o(13)),O=(r(o(1)),r(o(2))),k=scene,T=(k.Table,k.Component),R=k.Component3d,j=k.Container,P=k.Layout,x=k.Model,M={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"string",label:"zone",name:"zone",property:"zone"},{type:"number",label:"shelves",name:"shelves",property:"shelves"},{type:"number",label:"depth",name:"depth",property:"depth"},{type:"number",label:"min-section",name:"minSection"},{type:"number",label:"min-unit",name:"minUnit"},{type:"string",label:"location-pattern",name:"locPattern",property:{placeholder:"{z}{s}-{u}-{sh}"}},{type:"string",label:"shelf-pattern",name:"shelfPattern",property:{placeholder:"#, 00, 000"}},{type:"rack-increase-pattern",label:"",name:"increasePattern"},{type:"number",label:"stock-scale",name:"stockScale"},{type:"checkbox",label:"hide-rack-frame",name:"hideRackFrame"}]},H={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},S={strokeStyle:"",lineDash:"solid",lineWidth:0},C={strokeStyle:"#999",lineDash:"solid",lineWidth:1},z=P.get("table"),D={ondragmove:function(e,t,o){var r=o.textBounds,n=r.left,i=(r.top,r.width),a=(r.height,o.widths_sum),s=o.widths.slice(),l=n+s.slice(0,t+1).reduce(function(e,t){return e+t},0)/a*i,c=(o.transcoordP2S(e.x,e.y).x-l)/i*a,u=a/i*5;c=c<0?-Math.min(s[t]-u,-c):Math.min(s[t+1]-u,c),s[t]=Math.round(100*(s[t]+c))/100,s[t+1]=Math.round(100*(s[t+1]-c))/100,o.set("widths",s)}},A={ondragmove:function(e,t,o){var r=o.textBounds,n=(r.left,r.top),i=(r.width,r.height),a=o.heights_sum,s=o.heights.slice();t-=o.columns-1;var l=n+s.slice(0,t+1).reduce(function(e,t){return e+t},0)/a*i,c=(o.transcoordP2S(e.x,e.y).y-l)/i*a,u=a/i*5;c=c<0?-Math.min(s[t]-u,-c):Math.min(s[t+1]-u,c),s[t]=Math.round(100*(s[t]+c))/100,s[t+1]=Math.round(100*(s[t+1]-c))/100,o.set("heights",s)}},L=function(e){function t(e,o,r,a){n(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s._visualizer=r,s._sceneComponent=a,s.createRacks(o),s.mergeObjects(),s}return a(t,E.default),g(t,[{key:"dispose",value:function(){w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),delete this._visualizer}},{key:"createRacks",value:function(e){var t=this,o=this.model,r=o.components,n=void 0===r?[]:r,i=o.left,a=o.top,s=o.width,l=o.height,c=o.rotation,u=void 0===c?0:c,h=o.zone,f=o.locPattern,p=o.shelfPattern,d=o.shelves,y=void 0===d?1:d,m=o.depth,v=void 0===m?1:m,b=(o.increasePattern,o.columns,o.rows,o.minUnit,o.minSection,o.stockScale),_=void 0===b?.7:b,g=o.hideRackFrame,w=i+s/2-e.width/2,E=a+l/2-e.height/2;this.position.set(w,0,E),this.rotation.y=-u,n.forEach(function(e){var o={left:e.left,top:e.top,width:e.width,height:e.height,depth:v,shelves:y,unit:e.unit,section:e.section,zone:h,locPattern:f,shelfPattern:p,isEmpty:e.isEmpty,hideRackFrame:g,stockScale:_};if(!o.isEmpty){e=new O.default(o,t.model,t._visualizer);t.add(e)}})}},{key:"mergeObjects",value:function(){var e=[],t=[];this.children.forEach(function(o){e=e.concat(o.frames),t=t.concat(o.boards)});var o;e.forEach(function(e){e.children.forEach(function(e){o?o.geometry.merge(e.geometry):o=e})});var r;t.forEach(function(e){r?r.geometry.merge(e.geometry):r=e})}},{key:"raycast",value:function(e,t){}},{key:"onchange",value:function(e,t){e.hasOwnProperty("data")&&(this.data=e.data)}}]),t}();t.default=L;var F=t.RackTable=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,j),g(t,[{key:"is3dish",value:function(){return!0}},{key:"dispose",value:function(){w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this),delete this._focused_cell}},{key:"_post_draw",value:function(e){w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_post_draw",this).call(this,e),this.app.isEditMode&&(this._focused&&(this._draw_column_header(e),this._draw_row_header(e),this._draw_header_joint(e)),this._focused_cell&&this._draw_highlight(e))}},{key:"_draw_column_header",value:function(e){var t=this,o=this.bounds,r=o.left,n=o.top,i=o.width,a=(o.height,this.model),s=(a.minUnit,a.minSection,a.increasePattern),l=void 0===s?"+u+s":s;a.columns;e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc",e.fillStyle="rgba(230, 230, 230, 0.5)",e.moveTo(r,n-50),e.rect(r,n-50,i,50),e.fill();var c=this.getCellsByRow(0),u=l.match(/([\+,\-])([u,s])([\+,\-])([u,s])/i);if(!u||u.length<5)return console.warn("Rack Pattern Error",l),!1;c.forEach(function(o,i){var a=o.model.width,s="u"==u[2]?o.get("unit"):o.get("section");s&&t._draw_location_header_text(e,{left:r,top:n-50,width:a,height:50},s,t.model),r+=a,e.moveTo(r,n-50),e.lineTo(r,n)}),e.stroke(),e.closePath()}},{key:"_draw_row_header",value:function(e){var t=this,o=this.bounds,r=o.left,n=o.top,i=(o.width,o.height),a=this.model,s=(a.minUnit,a.minSection,a.increasePattern),l=void 0===s?"+u+s":s;a.rows;e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc",e.fillStyle="rgba(230, 230, 230, 0.5)",e.moveTo(r-50,n),e.rect(r-50,n,50,i),e.fill();var c=this.getCellsByColumn(0),u=l.match(/([\+,\-])([u,s])([\+,\-])([u,s])/i);if(!u||u.length<5)return console.warn("Rack Pattern Error",l),!1;c.forEach(function(o,i){var a=o.model.height,s="u"==u[4]?o.get("unit"):o.get("section");s&&t._draw_location_header_text(e,{left:r-50,top:n,width:50,height:a},s,t.model),n+=a,e.moveTo(r-50,n),e.lineTo(r,n)}),e.stroke(),e.closePath()}},{key:"_draw_header_joint",value:function(e){var t=this.bounds,o=t.left,r=t.top,n=(t.width,t.height,this.model),i=(n.minUnit,n.minSection,n.increasePattern),a=void 0===i?"+u+s":i;n.rows;e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc",e.fillStyle="rgba(230, 230, 230, 0.5)",e.moveTo(o-50,r-50),e.rect(o-50,r-50,50,50),e.fill(),e.closePath(),e.beginPath(),e.moveTo(o-50,r-50),e.lineTo(o,r),e.stroke();this.getCellsByColumn(0);var s=a.match(/([\+,\-])([u,s])([\+,\-])([u,s])/i);if(!s||s.length<5)return console.warn("Rack Pattern Error",a),!1;var l,c;"u"==s[2]?(l="U",c="S"):(l="S",c="U"),this._draw_location_header_text(e,{left:o-25,top:r-50,width:25,height:25},l,this.model),this._draw_location_header_text(e,{left:o-50,top:r-25,width:25,height:25},c,this.model),e.closePath()}},{key:"_draw_location_header_text",value:function(e,t,o,r){var n=r.alpha,i=r.fontColor,a=void 0===i?"#000":i;r.fontSize,r.lineHeight;e.save(),e.beginPath();var s=t.left,l=t.top,c=t.width,u=t.height;e.font=T.font(r);var h;h=l+u/2,e.textBaseline="middle";var f;f=s+c/2,e.textAlign="center",e.globalAlpha*=n,e.fillStyle=a,e.fillText(o,f,h),e.restore()}},{key:"_draw_highlight",value:function(e){var t=this._focused_cell.bounds,o=t.left,r=t.top,n=t.width,i=t.height,a=r+i,s=o+n,l=this.bounds.left,c=this.bounds.top;e.beginPath(),e.strokeStyle="rgba(0, 0, 99, 0.9)",e.rect(l-50,c+r,s+50,i),e.rect(l+o,c-50,n,a+50),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle="rgba(0, 0, 255, 0.5)",e.rect(l-50,c+r,50,i),e.rect(l+o,c-50,n,50),e.fill(),e.closePath()}},{key:"created",value:function(){var e=this.rows*this.columns,t=this.size()-e;if(0!=t){if(t>0){var o=this._components.slice(t);this.remove(o)}else{for(var r=[],n=0;n<-t;n++)r.push(s(this.app));this.add(r)}var i=this.get("widths"),a=this.get("heights");(!i||i.length<this.columns)&&this.set("widths",this.widths),(!a||a.length<this.rows)&&this.set("heights",this.heights)}}},{key:"added",value:function(){this.setCellLocations()}},{key:"buildCells",value:function(e,t,o,r){if(e<o){var n=this._components.slice(r*e);this.remove(n)}var i=Math.min(e,o);if(t>r)for(var a=0;a<i;a++)for(var l=r;l<t;l++)this.insertComponentAt(s(this.app),a*t+l);else if(t<r){for(var c=[],u=0;u<i;u++)for(var h=t;h<r;h++)c.push(this.components[u*r+h]);this.remove(c)}if(e>o){for(var f=[],p=o;p<e;p++)for(var d=0;d<t;d++)f.push(s(this.app));this.add(f)}this.set({widths:this.widths,heights:this.heights}),this.setCellLocations()}},{key:"setCellLocations",value:function(){for(var e=this.model,t=e.minUnit,o=void 0===t?1:t,r=e.minSection,n=void 0===r?1:r,i=e.increasePattern,a=void 0===i?"+u+s":i,s=this.get("columns"),l=this.get("rows"),c=[],u=[],h=0;h<s;h++){(f=this.getCellsByColumn(h)).every(function(e){e.model.unit=e.model.section=void 0}),c.push(f)}for(h=0;h<l;h++){var f=this.getCellsByRow(h);f.every(function(e){e.model.unit=e.model.section=void 0}),u.push(f)}var p=a.match(/([\+,\-])([u,s])([\+,\-])([u,s])/i);if(!p||p.length<5)return console.warn("Rack Pattern Error",a),!1;for(var d=0,y=0,h=0;h<l;h++){var m=0,v=u[h].filter(function(e){return e.model.isEmpty});if(v.length!==s){d="u"==p[4]?"+"==p[3]?y+o:l-y-1+o:"+"==p[3]?y+n:l-y-1+n;for(var b=0;b<s;b++){var _=0,g=c[b];(v=g.filter(function(e){return e.model.isEmpty})).length!==l&&(_="u"==p[2]?"+"==p[1]?m+o:s-m-1+o:"+"==p[1]?m+n:s-m-1+n,"u"==p[2]?(g[h].model.unit=""+String(_).padStart(2,0),g[h].model.section=""+String(d).padStart(2,0)):(g[h].model.unit=""+String(d).padStart(2,0),g[h].model.section=""+String(_).padStart(2,0)),m++)}y++}}}},{key:"setCellsStyle",value:function(e,t,o){var r=this,n=this.components,i=n.length,a=this.get("columns"),s=[];e.forEach(function(e){if(s.push(e),e.colspan||e.rowspan)for(var t=r.getRowColumn(e).column,o=r.getRowColumn(e).row,n=o;n<o+e.rowspan;n++)for(var i=t;i<t+e.colspan;i++)n==o&&i==t||s.push(r.components[n*r.columns+i])});var l=s.map(function(e){return n.indexOf(e)});l.forEach(function(e){var r=n[e];switch(o){case"all":u(r,t,o),h(0,a,l,e)&&u(n[v(a,e)],t,"right"),f(i,a,l,e)&&u(n[b(a,e)],t,"left"),p(0,a,l,e)&&u(n[y(a,e)],t,"bottom"),d(i,a,l,e)&&u(n[m(a,e)],t,"top");break;case"in":h(0,a,l,e)||u(r,t,"left"),f(i,a,l,e)||u(r,t,"right"),p(0,a,l,e)||u(r,t,"top"),d(i,a,l,e)||u(r,t,"bottom");break;case"out":h(0,a,l,e)&&(u(r,t,"left"),u(n[v(a,e)],t,"right")),f(i,a,l,e)&&(u(r,t,"right"),u(n[b(a,e)],t,"left")),p(0,a,l,e)&&(u(r,t,"top"),u(n[y(a,e)],t,"bottom")),d(i,a,l,e)&&(u(r,t,"bottom"),u(n[m(a,e)],t,"top"));break;case"left":h(0,a,l,e)&&(u(r,t,"left"),u(n[v(a,e)],t,"right"));break;case"right":f(i,a,l,e)&&(u(r,t,"right"),u(n[b(a,e)],t,"left"));break;case"center":h(0,a,l,e)||u(r,t,"left"),f(i,a,l,e)||u(r,t,"right");break;case"middle":p(0,a,l,e)||u(r,t,"top"),d(i,a,l,e)||u(r,t,"bottom");break;case"top":p(0,a,l,e)&&(u(r,t,"top"),u(n[y(a,e)],t,"bottom"));break;case"bottom":d(i,a,l,e)&&(u(r,t,"bottom"),u(n[m(a,e)],t,"top"));break;case"clear":u(r,S,"all"),h(0,a,l,e)&&u(n[v(a,e)],S,"right"),f(i,a,l,e)&&u(n[b(a,e)],S,"left"),p(0,a,l,e)&&u(n[y(a,e)],S,"bottom"),d(i,a,l,e)&&u(n[m(a,e)],S,"top")}})}},{key:"getRowColumn",value:function(e){var t=this.components.indexOf(e);this.components.length;return{column:t%this.columns,row:Math.floor(t/this.columns)}}},{key:"getCellsByRow",value:function(e){return this.components.slice(e*this.columns,(e+1)*this.columns)}},{key:"getCellsByColumn",value:function(e){for(var t=[],o=0;o<this.rows;o++)t.push(this.components[this.columns*o+e]);return t}},{key:"deleteRows",value:function(e){var t=this,o=[];e.forEach(function(e){var r=t.getRowColumn(e).row;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse();var r=this.heights.slice();o.forEach(function(e){t.remove(t.getCellsByRow(e))}),r.splice(o,1),this.model.rows-=o.length,this.set("heights",r)}},{key:"deleteColumns",value:function(e){var t=this,o=[];e.forEach(function(e){var r=t.getRowColumn(e).column;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse(),o.forEach(function(e){var o=t.widths.slice();t.remove(t.getCellsByColumn(e)),o.splice(e,1),t.model.columns-=1,t.set("widths",o)})}},{key:"insertCellsAbove",value:function(e){var t=this,o=[];if(e.forEach(function(e){var r=t.getRowColumn(e).row;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse(),o.length>=2)return!1;var r=o[0],n=[],i=[];o.forEach(function(e){for(var a=0;a<t.columns;a++)i.push(l(t.components[e*t.columns+a].model,t.app));n.push(t.heights[e]),i.reverse().forEach(function(e){t.insertComponentAt(e,r*t.columns)});var s=t.heights.slice();s.splice.apply(s,[r,0].concat(n)),t.set("heights",s),t.model.rows+=o.length,t.clearCache()})}},{key:"insertCellsBelow",value:function(e){var t=this,o=[];if(e.forEach(function(e){var r=t.getRowColumn(e).row;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse(),o.length>=2)return!1;var r=o[o.length-1]+1,n=[],i=[];o.forEach(function(e){for(var o=0;o<t.columns;o++)i.push(l(t.components[e*t.columns+o].model,t.app));n.push(t.heights[e]),i.reverse().forEach(function(e){t.insertComponentAt(e,r*t.columns)});var a=t.heights.slice();a.splice.apply(a,[r,0].concat(n)),t.set("heights",a),t.model.rows+=1,t.clearCache()})}},{key:"insertCellsLeft",value:function(e){var t=this,o=[];if(e.forEach(function(e){var r=t.getRowColumn(e).column;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse(),o.length>=2)return!1;var r=o[0],n=[],i=[];o.forEach(function(e){for(var a=0;a<t.rows;a++)i.push(l(t.components[e+t.columns*a].model,t.app));n.push(t.widths[e]);var s=t.columns,c=t.rows;i.reverse().forEach(function(e){0==c&&(c=t.rows,s++),c--,t.insertComponentAt(e,r+c*s)});var u=t.widths.slice();t.model.columns+=o.length,u.splice.apply(u,[r,0].concat(n)),t.set("widths",u)})}},{key:"insertCellsRight",value:function(e){var t=this,o=[];if(e.forEach(function(e){var r=t.getRowColumn(e).column;-1==o.indexOf(r)&&o.push(r)}),o.sort(function(e,t){return e-t}),o.reverse(),o.length>=2)return!1;var r=o[o.length-1]+1,n=[],i=[];o.forEach(function(e){for(var a=0;a<t.rows;a++)i.push(l(t.components[e+t.columns*a].model,t.app));n.push(t.widths[e]);var s=t.columns,c=t.rows;i.reverse().forEach(function(e){0==c&&(c=t.rows,s++),c--,t.insertComponentAt(e,r+c*s)});var u=t.widths.slice();t.model.columns+=o.length,u.splice.apply(u,[r,0].concat(n)),t.set("widths",u)})}},{key:"distributeHorizontal",value:function(e){var t=this,o=[];e.forEach(function(e){var r=t.getRowColumn(e);-1==o.indexOf(r.column)&&o.push(r.column)});var r=o.reduce(function(e,o){return e+t.widths[o]},0),n=Math.round(r/o.length*100)/100,i=this.widths.slice();o.forEach(function(e){i[e]=n}),this.set("widths",i)}},{key:"distributeVertical",value:function(e){var t=this,o=[];e.forEach(function(e){var r=t.getRowColumn(e);-1==o.indexOf(r.row)&&o.push(r.row)});var r=o.reduce(function(e,o){return e+t.heights[o]},0),n=Math.round(r/o.length*100)/100,i=this.heights.slice();o.forEach(function(e){i[e]=n}),this.set("heights",i)}},{key:"onchange",value:function(e,t){(function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];for(var n in o)if(e.hasOwnProperty(o[n]))return!0})(e,"rows","columns")&&this.buildCells(this.get("rows"),this.get("columns"),t.hasOwnProperty("rows")?t.rows:this.get("rows"),t.hasOwnProperty("columns")?t.columns:this.get("columns")),this.invalidate()}},{key:"oncellchanged",value:function(e,t){this.setCellLocations(),this.invalidate()}},{key:"contains",value:function(e,o){var r=w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"contains",this).call(this,e,o);return r?this._focused=!0:(this._focused=!1,this._focused_cell=null),this.invalidate(),r}},{key:"oncelldragstarted",value:function(e,t){t.origin;this._focused_cell=null}},{key:"oncellmouseentered",value:function(e,t){var o=t.origin;this._focused_cell=o}},{key:"oncellmouseleaved",value:function(e,t){this._focused_cell=null}},{key:"focusible",get:function(){return!1}},{key:"widths",get:function(){var e=this.get("widths");return e?e.length<this.columns?e.concat(_(0,this.columns-e.length)):e.length>this.columns?e.slice(0,this.columns):e:_(0,this.columns)}},{key:"heights",get:function(){var e=this.get("heights");return e?e.length<this.rows?e.concat(_(0,this.rows-e.length)):e.length>this.rows?e.slice(0,this.rows):e:_(0,this.rows)}},{key:"layout",get:function(){return z}},{key:"rows",get:function(){return this.get("rows")}},{key:"columns",get:function(){return this.get("columns")}},{key:"lefts",get:function(){var e=this;return this.components.filter(function(t,o){return!(o%e.columns)})}},{key:"centers",get:function(){var e=this;return this.components.filter(function(t,o){return o%e.columns&&(o+1)%e.columns})}},{key:"rights",get:function(){var e=this;return this.components.filter(function(t,o){return!((o+1)%e.columns)})}},{key:"tops",get:function(){return this.components.slice(0,this.columns)}},{key:"middles",get:function(){return this.components.slice(this.columns,this.columns*(this.rows-1))}},{key:"bottoms",get:function(){return this.components.slice(this.columns*(this.rows-1))}},{key:"all",get:function(){return this.components}},{key:"widths_sum",get:function(){var e=this,t=this.widths;return t?t.filter(function(t,o){return o<e.columns}).reduce(function(e,t){return e+t},0):this.columns}},{key:"heights_sum",get:function(){var e=this,t=this.heights;return t?t.filter(function(t,o){return o<e.rows}).reduce(function(e,t){return e+t},0):this.rows}},{key:"nature",get:function(){return M}},{key:"controls",get:function(){var e=this.widths,t=this.heights,o=this.textBounds,r=o.width/this.widths_sum,n=o.height/this.heights_sum,i=o.left,a=o.top,s=[];return e.slice(0,this.columns-1).forEach(function(e){i+=e*r,s.push({x:i,y:o.top,handler:D})}),t.slice(0,this.rows-1).forEach(function(e){a+=e*n,s.push({x:o.left,y:a,handler:A})}),s}},{key:"eventMap",get:function(){return{"(self)":{"(descendant)":{change:this.oncellchanged,mouseenter:this.oncellmouseentered,dragstart:this.oncelldragstarted}}}}}]),t}();["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(function(e){return T.memoize(F.prototype,e,!1)}),T.register("rack-table",F),R.register("rack-table",L)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function(e){function t(e,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._model=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,THREE.Group),r(t,[{key:"dispose",value:function(){var e=this;this.children.slice().forEach(function(t){t.dispose&&t.dispose(),t.geometry&&t.geometry.dispose&&t.geometry.dispose(),t.material&&t.material.dispose&&t.material.dispose(),t.texture&&t.texture.dispose&&t.texture.dispose(),e.remove(t)})}},{key:"createObject",value:function(e){}},{key:"model",get:function(){return this._model}}]),t}();t.default=n},,function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=scene,l=s.Component,c=s.Rect,u=function(e){function t(e,o){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._model=e,i.createObject(e,o),i}return i(t,THREE.Mesh),a(t,[{key:"createObject",value:function(e,t){var o=e.left+e.width/2-t.width/2,r=e.top+e.height/2-t.height/2,n=.5*e.depth,i=e.rotation;this.type=e.type,this.createDoor(e.width,e.height,e.depth),this.position.set(o,n,r),this.rotation.y=i||0}},{key:"createDoor",value:function(e,t,o){var r=this.model.fillStyle,n=void 0===r?"saddlebrown":r;this.geometry=new THREE.BoxGeometry(e,o,t),this.material=new THREE.MeshLambertMaterial({color:n,side:THREE.FrontSide})}},{key:"model",get:function(){return this._model}}]),t}();t.default=u;var h=t.Door2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,c),a(t,[{key:"is3dish",value:function(){return!0}}]),t}();l.register("door",h),scene.Component3d.register("door",u)},function(e,t,o){"use strict";function r(){if(!r.done){r.done=!0;var e=new THREE.OBJLoader,t=new THREE.MTLLoader;e.setPath("./obj/Fork_lift/"),t.setPath("./obj/Fork_lift/"),t.load("ForkLift.mtl",function(t){t.preload(),e.setMaterials(t),t.side=THREE.frontSide,e.load("ForkLift.obj",function(e){n=e})})}}Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),s=function(e){function t(e,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.createObject(e,o),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"createObject",value:function(e){var o=this.model,r=o.left,n=o.top,i=(o.width,o.height,o.cx),a=o.cy,s=(o.depth,o.rotation),l=void 0===s?0:s;if(t.extObject){i-=e.width/2,a-=e.height/2;var r=r-e.width/2,n=n-e.height/2,l=l;this.type="forklift",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(i,0,a),this.rotation.y=l}else setTimeout(this.createObject.bind(this,this.model,e),50)}}],[{key:"extObject",get:function(){return n||r(),n}}]),t}();t.default=s,scene.Component3d.register("forklift",s)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Sensor=void 0;var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),l=["#6666ff","#ccccff","#ffcccc","#cc3300"],c={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"z-pos",name:"zPos",property:"zPos"},{type:"string",label:"location",name:"location",property:"location"}]},u=function(e){function t(e,o,i){r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a._container=i,a.userData.temperature=e.humidity?e.humidity[0]:0,a.userData.humidity=e.humidity?e.humidity[1]:0,a.createObject(o),a}return i(t,s.default),a(t,[{key:"createObject",value:function(e){var t=this.model,o=(t.left,t.top,t.width,t.height,t.depth),r=t.cx,n=t.cy,i=t.rx,a=t.ry,s=t.zPos,l=t.rotation,c=void 0===l?0:l,u=t.location;r-=e.width/2,n-=e.height/2;var h=(s||0)+o/2;this.type="humidity-sensor",u&&(this.name=u);for(var f=0;f<3;f++){this.createSensor(i*(1+.5*f),a*(1+.5*f),o*(1+.5*f),f).material.opacity=.5-.15*f}this.position.set(r,h,n),this.rotation.y=c,this._container._heatmap.addData({x:Math.floor(r),y:Math.floor(n),value:this.userData.temperature}),this._container.updateHeatmapTexture()}},{key:"createSensor",value:function(e,t,o,r){var n,i=0===r,a=new THREE.SphereGeometry(e,32,32);n=i?new THREE.MeshLambertMaterial({color:"#cc3300",side:THREE.FrontSide}):new THREE.MeshBasicMaterial({color:"#cc3300",side:THREE.FrontSide,wireframe:!0,wireframeLinewidth:1});var s=new THREE.Mesh(a,n);return s.material.transparent=!0,i?s.onmousemove=this.onmousemove:s.raycast=function(){},this.add(s),s}},{key:"onUserDataChanged",value:function(){(function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,o,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onUserDataChanged",this).call(this);var e=this._model,o=e.cx,r=e.cy;o=Math.floor(o),r=Math.floor(r);var n=this.userData.temperature,i=!0,a=!1,s=void 0;try{for(var c,u=this.children[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var h=c.value,f=0;f=n<0?0:n<10?1:n<20?2:3,h.material.color.set(l[f])}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}var p=this._container._heatmap._store._data[o][r];this._container._heatmap.addData({x:o,y:r,value:n-p}),this._container._heatmap.repaint(),this._container.updateHeatmapTexture()}},{key:"onmousemove",value:function(e,t){var o=t.tooltip||t._scene2d.getObjectByName("tooltip");if(o&&(t._scene2d.remove(o),t.tooltip=null,t.render_threed()),this.parent.visible){this.parent.userData||(this.parent.userData={});var r="";for(var n in this.parent.userData)this.parent.userData[n]&&(r+=n+": "+this.parent.userData[n]+"\n");if(r.length>0){o=t.tooltip=t.makeTextSprite(r);var i=new THREE.Vector3,a=o.getWorldScale().clone(),s=a.x/t.model.width,l=a.y/t.model.height;i.set(t._mouse.x,t._mouse.y,.5),a.normalize(),a.x=a.x/2*s,a.y=-a.y/2*l,a.z=0,i.add(a),i.unproject(t._2dCamera),o.position.set(i.x,i.y,i.z),o.name="tooltip",o.scale.x=o.scale.x*s,o.scale.y=o.scale.y*l,t._scene2d.add(o),t._renderer&&t._renderer.render(t._scene2d,t._2dCamera),t.invalidate()}}}}]),t}();t.default=u;var h=scene,f=h.Component,p=h.Ellipse,d=t.Sensor=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,p),a(t,[{key:"is3dish",value:function(){return!0}},{key:"_draw",value:function(e){var t=this.bounds,o=t.left,r=t.top,n=t.width,i=t.height;e.beginPath(),e.rect(o,r,n,i),this.model.fillStyle={type:"pattern",fitPattern:!0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABBCAYAAACTiffeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTMyIDc5LjE1OTI4NCwgMjAxNi8wNC8xOS0xMzoxMzo0MCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUuNSAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDQ0E1QkUzRTRDMDcxMUU2QkMyRDk3MzlGN0EzMTI2NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDQ0E1QkUzRjRDMDcxMUU2QkMyRDk3MzlGN0EzMTI2NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjJFQ0Q4QzE5NEI1MjExRTZCQzJEOTczOUY3QTMxMjY1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjJFQ0Q4QzFBNEI1MjExRTZCQzJEOTczOUY3QTMxMjY1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+tgU1kQAAB4pJREFUeNrcWktMVFcYPgPIVHxTERpsq4XaBwZbjRIjaUO0qbGuWDQQFnZhgkuty7qUhMQYTdqFGl10YcSYUBfWkEjCxtREClEDJkZgbAsWxYIIKjPCTP/v8p3xOtyZe+4dRtA/+XIv957H/53zv+4ZArFYTL0NEvBCJBAIzHhWsmZNllwWChYJ3iGCaC7IEWQLooJJXsNERPBc8LT33r0XbnO76WlEJJGAKA9F8wUrSGBBQpcsKm3vGCOmbM+m2GZC8ETwWDAuxKJeSaUkYifAlX9X8J5gqU1hRWWwuuO8QrEXVFQrm00EiTzuZA7bxEge/UYEQ0LouSkZRyIOBIqJXCqfxQkfCh4JRmXSSa92jblL164FoWXc3eUkFSXGBPdl7HE3Mq8QcSBQJFhjs3ms6KCgvycUGnHymXRE5sTurBIU0tc0IZjcgBB6loxMnEgCicVy+YwmpM3nH0FIBgtnOgJxp7BD7wuW2ILFABbS7kOORDjAh/LnOq4+SPwruOO0Gq+JUIHcrqUvgQD0uKv9ZwYR6QDFy+nMWQyPN6XDAw+mEaStL6Uz59peRxh2x+hTYx7GhW4lNHUdEEBm2IkIJv+Kk0P5dmkYcZkgi8Q/EqxmSI7aIlnUFoq1M0bp0GH6W4j2HzYgtFIuZbaxe8RX789wdiGzkop1ycCxFANitddzB/M4cMCWK5ATRhmGdd4IMucsseWdSZtD93HeRy5kMN9GjnEDQccx/KaKRDIIdqtC8CUH0spbfkRnfOiW0GScZbad/IC7ppPlPcGfMBsXPYJCYsw4j9g6l8rlW65qNlf7Jid9kmbI/VTwBU1zkrgh6JCxp3wnRDsZOto3gk1cOQx8TfDHbIZimQcTfkI/zeM8/wkuJS6U5xJFfAaK1wo+5iOYULMMPJSpkEuz+VqwgeaGcPubzDmYqnh0LRqFDDL7Hm7176alCE1mKTM0Vve5FxOU/kjIu+mHfwkuiE9E06p+hcxyUeKxy8QLGBoRUZBUC7iiAVtIjtCZewSdepVTjIn6rhI7IiQis/I9kiyayWQL6UNVgsVUPjF3BGylfNR2f1dwWQjdSeU7QsJVybQ+rGQShOEfWL3qRNfNaBais46zvNAhdx13bZUt5HYKmpyyvfFCe/3UBRlGmO8F3zEUI3q10odGDSMUfKCauQSLgLzxi/T/2ysJX0ToMyizG/lhhJX/WRS47zPkwixruCDYkUNiSo8z+s2eQAZJbBdXMeJlFR1M9HO5/IjQLiQu+y6V/YJFo+9xEsjkp6NLIN3jIP0ds3fvXjjzVlYAKChLbRWxog/0M/R2ofxAhXDmzJlRr/4wq6alRQhsZeLayWjkRRCtWlCGnD59+tqcEBECWPk6ljBFaVYmSIznBGeFUMdrISIE4Kn7BPWshxwlJydH1dTUqC1btlh/X79+XTU1NanJyZQVDvLPScEJIRTLGBEhgZLhoOCAW9u6ujpVVVX1yrMrV66o8+fPm0x1THBUyAyY6pblgQSct8GEBKSiosK6NjQ0qCNHjlj327ZtM50OczRwTiPJ8bATh1gFG0leXp51DYVCM55BZLXt4zsNsYfvfjLZmRxDnzjohYTh4pg0w5zD0vagm8+YmNY+U3PKkBygDv59hCG2Xs291FMX36ZVlyrEpiMGPmKXDdSlwzMRZuzaTC2xoY/YpVb6XEhWAaQyrd2zkLFnU4qok7mPsADcqeaf7KRuxqa11UcBmEkf0bKRurWYEtmU6aX14SN23VpMfWS9mr+y3ouzl85jIqVefGR1prXx6SNJdUtGJH8e+0h+WmX8fJdkRIbTGbS8vNy69vX1xZ/pe/0uDRn2QqTfzwwFBQWqtrZW1ddP15m3b9+Ov9P3eIc2aOtT+r0Q6fFDorq6Wm3fvl0Fg0HrG/3ixYvx97jHM7xDG7T1SabHC5Eur6Pv2LFDbd68WU1MTKjGxkZ16tSpGW3wDO/QBm3Rx4d0eSHS4dUnKisrrfvjx4+rnp7kG4p3aANBHx8+0+GFCErlTtORy8rK4uakSayIxVR1JKwOP3tqAfcreGKDNtrM0NeDdFI3MyKSrEad6plkUlJSYl3b2triz6peRNSucEQVTUUt4B7PtOi2uq+htFA3T3nkkpo+AXSVwsJC6zow8PKwY6PDQZz9mW6r+xrIIHXy9s3OL7Fz8yjnnUt1PuyW2c+q6WPMlPLgwfT/3RQXF7805pyZ1Y/9mW6r+7rITeri7xSFB8on3Wbp7e2d9gvbEWnbglx1OZirBrOzLOAez+I+xLa6r4ucdDvcNqm1Tqjps9ik0t3drcLhsHVgXVo6XWWPBAKqOTeoDuUtsoD7Ef5ShTZoiz7o6yLHqINKiwhP+I4Kfk3W5tatW+rq1avW/f79++NkHD8m5B3aQNAHfVMI5jxqcjJvfBrPA+Wk57+6REHGhiBPIMTq6ASfgDnpnxna29tVc3OzGhoaSkXisJAwKpdm9WcFkEHZgYyNZOckMCfsRGtrayoSnn9WyMgPPSg7kLGR7HSeQHSCY8MnUpjT6/mhJ4HQm/3TmwOhN/vHUAdCvn6eTlY7zRmRuZa3hsj/AgwA2qER3p3SY8gAAAAASUVORK5CYII="},this.drawFill(e)}},{key:"nature",get:function(){return c}}]),t}();f.register("humidity-sensor",d),scene.Component3d.register("humidity-sensor",u)},function(e,t,o){"use strict";function r(){if(!r.done){r.done=!0;var e=new THREE.TGALoader;THREE.Loader.Handlers.add(/\.tga$/i,e);var t=new THREE.OBJLoader,o=new THREE.MTLLoader;t.setPath("./obj/Casual_Man_02/"),o.setPath("./obj/Casual_Man_02/"),o.load("Casual_Man.mtl",function(e){e.preload(),t.setMaterials(e),e.side=THREE.frontSide,t.load("Casual_Man.obj",function(e){n=e})})}}Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),s=function(e){function t(e,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._visualizer=r,n.createObject(o),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"createObject",value:function(e){var o=this.model,r=o.left,n=o.top,i=o.width,a=o.height,s=o.rotation;if(t.extObject){var l=r+i/2-e.width/2,c=n+a/2-e.height/2;depth;r-=e.width/2,n-=e.height/2,this.type="person";var u=t.extObject.clone();this.add(u),u.scale.set(150,150,150),this.position.set(l,0,c),this.rotation.y=s,this._visualizer.render_threed()}else setTimeout(this.createObject.bind(this,this.model,e),50)}}],[{key:"extObject",get:function(){return n||r(),n}}]),t}();t.default=s,scene.Component3d.register("person",s)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=(scene.Component,function(e){function t(e,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._model=e,r.createObject(e,o),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,THREE.Mesh),r(t,[{key:"createObject",value:function(e,t){this.createPlane(e.width,e.height,e.fillStyle);var o=e.left+e.width/2-t.width/2,r=e.top+e.height/2-t.height/2;this.position.x=o,this.position.z=r}},{key:"createPlane",value:function(e,t,o){if(this.geometry=new THREE.PlaneGeometry(e,t),o&&"pattern"==o.type&&o.image){var r=(new THREE.TextureLoader).load(o.image);r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.repeat.set(1,1),this.material=new THREE.MeshBasicMaterial({map:r,side:THREE.FrontSide})}else this.material=new THREE.MeshBasicMaterial({color:o||"#ccaa76",side:THREE.FrontSide});this.rotation.x=-Math.PI/2,this.type="rect"}}]),t}());t.default=n,scene.Component3d.register("rect",n)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Wall2d=void 0;var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=function(e){return e&&e.__esModule?e:{default:e}}(o(4)),l=scene,c=l.Component,u=l.RectPath,h=l.Shape,f={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"depth",property:"depth"}]},p=function(e){function t(e,o){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createObject(o),i}return i(t,s.default),a(t,[{key:"createObject",value:function(e){var t=this.model,o=t.type,r=t.left,n=t.top,i=t.width,a=t.height,s=t.depth,l=void 0===s?1:s,c=t.rotation,u=void 0===c?0:c,h=t.alpha,f=void 0===h?.7:h,p=r+i/2-e.width/2,d=n+a/2-e.height/2,y=.5*l;this.type=o,this.createWall(i,a,l),this.position.set(p,y,d),this.rotation.y=u,this.material.opacity=f,this.material.transparent=f<1}},{key:"createWall",value:function(e,t,o){var r=this.model.fillStyle,n=void 0===r?"gray":r;this.geometry=new THREE.BoxGeometry(e,o,t),this.material=new THREE.MeshLambertMaterial({color:n,side:THREE.FrontSide})}}]),t}();t.default=p;var d=t.Wall2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,u(h)),a(t,[{key:"is3dish",value:function(){return!0}},{key:"nature",get:function(){return f}}]),t}();c.register("wall",d),scene.Component3d.register("wall",p)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=scene,l=s.Component,c=s.Rect,u={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"depth",property:"depth"},{type:"checkbox",label:"show-axis",name:"showAxis",property:"showAxis"}]},h=function(e){function t(e,o,i){r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(a._model=e,a._visualizer=i,a.createObject(e,o),a.updateMatrixWorld(),e.showAxis){var s=new THREE.AxisHelper(100);a.add(s)}return a}return i(t,THREE.Mesh),a(t,[{key:"createObject",value:function(e,t){var o=e.left+e.width/2-t.width/2,r=e.top+e.height/2-t.height/2,n=e.zPos||.5*e.depth,i=e.rotation;this.type=e.type,this.createCube(e.width,e.height,e.depth),this.position.set(o,n,r),this.rotation.y=i||0}},{key:"createCube",value:function(e,t,o){var r=this.model.fillStyle,n=void 0===r?"lightgray":r;this.geometry=new THREE.BoxGeometry(e,o,t),this.material=new THREE.MeshLambertMaterial({color:n,side:THREE.FrontSide})}},{key:"model",get:function(){return this._model}},{key:"mixer",get:function(){return this._mixer||(this._mixer=new THREE.AnimationMixer(this),this._visualizer.mixers.push(this._mixer)),this._mixer}}]),t}();t.default=h;var f=t.Cube2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,c),a(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return u}}]),t}();l.register("cube",f),scene.Component3d.register("cube",h)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=scene,l=s.Component,c=s.Ellipse,u={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"rz",property:"rz"}]},h=function(e){function t(e,o){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._model=e,i.createObject(e,o),i}return i(t,THREE.Mesh),a(t,[{key:"createObject",value:function(e,t){var o=e.cx-t.width/2,r=e.cy-t.height/2,n=this.model.rz/2,i=e.rotation;this.type=e.type,this.createCylinder(this.model.rx,this.model.rz),this.position.set(o,n,r),this.rotation.y=i||0}},{key:"createCylinder",value:function(e,t){var o=this.model.fillStyle,r=void 0===o?"lightgray":o;this.geometry=new THREE.CylinderGeometry(e,e,t,25),this.material=new THREE.MeshLambertMaterial({color:r,side:THREE.FrontSide})}},{key:"model",get:function(){return this._model}}]),t}();t.default=h;var f=t.Cylinder2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,c),a(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return u}}]),t}();l.register("cylinder",f),scene.Component3d.register("cylinder",h)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=scene,l=s.Component,c=s.Ellipse,u={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"rz",property:"rz"}]},h=function(e){function t(e,o,i){r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._model=e,a._visualizer=i,a.createObject(e,o),a}return i(t,THREE.Mesh),a(t,[{key:"createObject",value:function(e,t){var o=e.cx-t.width/2,r=e.cy-t.height/2,n=this.model.rx,i=e.rotation;this.type=e.type,this.createSphere(this.model.rx,this.model.rz),this.position.set(o,n,r),this.rotation.y=i||0}},{key:"createSphere",value:function(e,t){var o=this.model.fillStyle,r=void 0===o?"lightgray":o;this.geometry=new THREE.SphereGeometry(e,20,20),this.material=new THREE.MeshLambertMaterial({color:r,side:THREE.FrontSide})}},{key:"model",get:function(){return this._model}}]),t}();t.default=h;var f=t.Sphere2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,c),a(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return u}}]),t}();l.register("sphere",f),scene.Component3d.register("sphere",h)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=scene,l=s.Component,c=s.Ellipse,u={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"rz",property:"rz"}]},h=function(e){function t(e,o){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._model=e,i.createObject(e,o),i}return i(t,THREE.Mesh),a(t,[{key:"createObject",value:function(e,t){var o=e.cx-t.width/2,r=e.cy-t.height/2,n=this.model.rx,i=e.rotation;this.type=e.type,this.createCone(this.model.rx,this.model.rz),this.position.set(o,n,r),this.rotation.y=i||0}},{key:"createCone",value:function(e,t){var o=this.model.fillStyle,r=void 0===o?"lightgray":o;this.geometry=new THREE.ConeGeometry(e,t,20),this.material=new THREE.MeshLambertMaterial({color:r,side:THREE.FrontSide})}},{key:"setEuler",value:function(e){var t=e.yaw,o=e.pitch,r=e.roll;this.setRotationFromEuler(new THREE.Vector3(r,o,t))}},{key:"setQuaternion",value:function(e){var t=e.x,o=e.y,r=e.z,n=e.w;this.setRotationFromQuaternion(new THREE.Quaternion(t,o,r,n))}},{key:"model",get:function(){return this._model}}]),t}();t.default=h;var f=t.Cone2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,c),a(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return u}}]),t}();l.register("cone",f),scene.Component3d.register("cone",h)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Banner2d=void 0;var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),l=scene,c=l.Component,u=l.ImageView,h=l.Component3d,f={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"z-pos",name:"zPos",property:"zPos"},{type:"number",label:"depth",name:"depth",property:"depth"},{type:"number",label:"rotation",name:"rotation",property:"rotation"},{type:"color",label:"box-color",name:"boxColor",property:"boxColor"}]},p=function(e){function t(e,o,i){r(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a._visualizer=i,a.createObject(o),a}return i(t,s.default),a(t,[{key:"createObject",value:function(e){var t=this.model,o=t.type,r=t.left,n=void 0===r?0:r,i=t.top,a=void 0===i?0:i,s=t.zPos,l=void 0===s?0:s,c=t.width,u=void 0===c?1:c,h=t.height,f=void 0===h?1:h,p=t.depth,d=void 0===p?1:p,y=t.rotation,m=void 0===y?0:y,v=n+u/2-e.width/2,b=a+f/2-e.height/2,_=l+.5*d;this.add(this.createCube(u,f,d));var g=this.createTextureBoard(u,d);this.add(g),g.position.set(0,0,.5*f),this.type=o,this.position.set(v,_,b),this.rotation.y=-m}},{key:"createCube",value:function(e,t,o){var r=this.model.boxColor,n=void 0===r?"#ccaa76":r,i=new THREE.BoxGeometry(e,o,t),a=new THREE.MeshLambertMaterial({color:n,side:THREE.FrontSide});return new THREE.Mesh(i,a)}},{key:"createTextureBoard",value:function(e,t){var o,r=this,n=this.model.fillStyle,i=void 0===n?"#ccaa76":n;if(i&&"pattern"==i.type&&i.image){var a=this._visualizer._textureLoader.load(this._visualizer.app.url(i.image),function(){r._visualizer.render_threed()});a.repeat.set(1,1),a.minFilter=THREE.LinearFilter,o=new THREE.MeshBasicMaterial({map:a,side:THREE.FrontSide})}else o=new THREE.MeshLambertMaterial({color:i||"#ccaa76",side:THREE.FrontSide});var s=new THREE.PlaneGeometry(e,t,1,1);return new THREE.Mesh(s,o)}},{key:"raycast",value:function(e,t){}}]),t}();t.default=p;var d=t.Banner2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,u),a(t,[{key:"is3dish",value:function(){return!0}},{key:"nature",get:function(){return f}}]),t}();c.register("banner",d),h.register("banner",p)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Desk2d=void 0;var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),s=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),l=scene,c=l.Component,u=l.Rect,h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"depth",property:"depth"},{type:"color",label:"leg-color",name:"legColor",property:"legColor"}]},f=function(e){function t(e,o,i,a){r(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s._visualizer=i,s.createObject(o),s}return i(t,s.default),a(t,[{key:"createObject",value:function(e){var t=this.model,o=(t.type,t.left),r=t.top,n=t.width,i=t.height,a=t.depth,s=t.rotation,l=void 0===s?0:s,c=o+n/2-e.width/2,u=r+i/2-e.height/2,h=.5*a,f=this.createDeskLegs(n,i,a);this.add(f),r=a/2-this.boardThickness;var p=this.createDeskBoard(n,i);p.position.set(0,r,0),p.rotation.x=Math.PI/2,this.add(p),this.position.set(c,h,u),this.rotation.y=l||0}},{key:"createDeskLegs",value:function(e,t,o){var r=this.legThickness,n=this.margin;o-=r;for(var i=new THREE.Group,a=e/2-r/2-n,s=t/2-r/2-n,l=-r,c=0;c<4;c++){var u=new THREE.BoxGeometry(r,o,r),h=new THREE.MeshBasicMaterial({color:this.model.legColor||"#252525"}),f=new THREE.Mesh(u,h);switch(c){case 0:f.position.set(a,l,s);break;case 1:f.position.set(a,l,-s);break;case 2:f.position.set(-a,l,s);break;case 3:f.position.set(-a,l,-s)}i.add(f)}return i}},{key:"createDeskBoard",value:function(e,t){var o=new THREE.MeshBasicMaterial({color:this.model.fillStyle||"#ccaa76"}),r=new THREE.BoxGeometry(e,t,10,1,1);return new THREE.Mesh(r,o)}},{key:"cube",value:function(e){var t=.5*e.width,o=.5*e.height,r=.5*e.depth,n=new THREE.Geometry;return n.vertices.push(new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,o,r),new THREE.Vector3(-t,o,r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,-o,r),new THREE.Vector3(t,-o,r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,-o,-r),new THREE.Vector3(-t,-o,r),new THREE.Vector3(-t,o,-r),new THREE.Vector3(-t,o,r),new THREE.Vector3(t,o,-r),new THREE.Vector3(t,o,r),new THREE.Vector3(t,-o,-r),new THREE.Vector3(t,-o,r)),n}},{key:"raycast",value:function(e,t){}},{key:"onchange",value:function(e,t){e.hasOwnProperty("data")&&(this.data=e.data)}},{key:"boardThickness",get:function(){var e=this.model.depth;return Math.min(10,e/10)}},{key:"legThickness",get:function(){var e=this.model,t=e.width,o=e.height,r=Math.min(t,o);return Math.min(10,r/10)}},{key:"margin",get:function(){return Math.min(this.legThickness/5,2)}}]),t}();t.default=f;var p=t.Desk2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,u),a(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return h}}]),t}();c.register("desk",p),scene.Component3d.register("desk",f)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),i=scene.Component3d,a=function(e){function t(e,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._visualizer=r,n.createObject(o),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),r(t,[{key:"createObject",value:function(e){var t=this.model,o=t.left,r=t.top,n=t.width,i=t.height,a=t.rotation,s=void 0===a?0:a,l=t.zPos,c=t.location,u=Math.min(n,i),h=o-e.width/2,f=r-e.height/2,p=(l||0)+u/2;this.type="beacon",c&&(this.name=c);for(var d=0;d<3;d++){this.createSensor(u*(1+.5*d)/2,d).material.opacity=.5-.15*d}this.position.set(h,p,f),this.rotation.y=s}},{key:"createSensor",value:function(e,t){var o,r=0===t,n=new THREE.SphereGeometry(e,32,32);o=r?new THREE.MeshLambertMaterial({color:"#57a1d6",side:THREE.FrontSide}):new THREE.MeshBasicMaterial({color:"#57a1d6",side:THREE.FrontSide,wireframe:!0,wireframeLinewidth:1});var i=new THREE.Mesh(n,o);return i.material.transparent=!0,this.add(i),i}}]),t}();t.default=a,i.register("beacon",a)},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){if(!a.done){a.done=!0;var e=new THREE.OBJLoader2;e.setPath("/obj/pallet/"),e.loadMtl("Pallet.mtl","pallet.mtl",null,function(t){e.setMaterials("pallet"),e.setMaterials(t),e.load("Pallet.obj",function(e){s=e})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.Pallet2d=void 0;var s,l=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),c=function(e){return e&&e.__esModule?e:{default:e}}(o(0)),u=scene,h=u.Rect,f=u.Component,p=u.Component3d,d={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"depth",name:"depth",property:"depth"}]},y=function(e){function t(e,o){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.createObject(o),i}return i(t,c.default),l(t,[{key:"createObject",value:function(e){var o=this.model,r=o.left,n=o.top,i=(o.width,o.height,o.cx),a=o.cy,s=(o.depth,o.rotation),l=void 0===s?0:s;if(t.extObject){i-=e.width/2,a-=e.height/2;var r=r-e.width/2,n=n-e.height/2;this.type="pallet",this.add(t.extObject.clone()),this.scale.set(10,10,10),this.position.set(i,0,a),this.rotation.y=l}else setTimeout(this.createObject.bind(this,this.model,e),50)}}],[{key:"extObject",get:function(){return s||a(),s}}]),t}();t.default=y;var m=t.Pallet2d=function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,h),l(t,[{key:"is3dish",value:function(){return!0}},{key:"controls",get:function(){}},{key:"nature",get:function(){return d}}]),t}();f.register("pallet",m),p.register("pallet",y)}]);